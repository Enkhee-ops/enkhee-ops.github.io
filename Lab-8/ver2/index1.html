<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Монгол Hangman Тоглоом</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            width: 90%;
            max-width: 900px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
        }

        h1, h2 {
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            margin: 8px;
        }

        button:hover {
            background: #ff5252;
            transform: translateY(-3px);
        }

        input, select {
            padding: 12px;
            border-radius: 10px;
            border: none;
            width: 100%;
            margin: 10px 0;
            font-size: 16px;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Hangman Canvas */
        #hangman-canvas {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            margin: 20px auto;
            display: block;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        /* Word Display */
        .word-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 30px 0;
        }

        .letter-slot {
            width: 50px;
            height: 60px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            font-weight: bold;
            position: relative;
        }

        .position-number {
            position: absolute;
            top: -20px;
            font-size: 14px;
            color: #ffd700;
        }

        .revealed {
            background: #4caf50;
        }

        /* Keyboard and other styles remain the same */
        .keyboard {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            max-width: 600px;
            margin: 30px auto;
        }

        .key {
            padding: 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.2s;
        }

        .key.used {
            background: #666;
            cursor: not-allowed;
        }

        .key:hover:not(.used) {
            background: rgba(255,255,255,0.4);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .stat-item {
            text-align: center;
        }

        .lives {
            font-size: 30px;
        }

        .powerups {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .powerup-btn {
            background: #9c27b0;
            padding: 10px 15px;
            font-size: 14px;
        }

        .powerup-btn.disabled {
            background: #666;
            cursor: not-allowed;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        th {
            background: rgba(0,0,0,0.3);
        }

        @media (max-width: 768px) {
            .keyboard {
                grid-template-columns: repeat(6, 1fr);
            }
            .letter-slot {
                width: 40px;
                height: 50px;
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Main Menu, Game Screen, Leaderboard same as before -->
        <!-- (Keeping the same structure, only changing the script part below) -->

        <div id="main-menu" class="screen active">
            <h1>МОНГОЛ ХАНГМАН</h1>
            <div>
                <label>Нэрээ оруулна уу:</label>
                <input type="text" id="username" placeholder="Тоглогчийн нэр" maxlength="15">
            </div>
            <div>
                <label>Тоглоомын горим:</label>
                <select id="game-mode">
                    <option value="standard">Стандарт (Нэг раунд)</option>
                    <option value="infinite" selected>Хязгааргүй (Үхэх хүртэл)</option>
                    <option value="timed">Цагтай (Хурдны сорил)</option>
                </select>
            </div>
            <div>
                <label>Ангилал сонгох:</label>
                <select id="category">
                    <option value="animals">Амьтан</option>
                    <option value="vehicles">Тээврийн хэрэгсэл</option>
                    <option value="geography">Газарзүй</option>
                    <option value="general">Ерөнхий мэдлэг</option>
                </select>
            </div>
            <button onclick="showLeaderboard()">Шилдэг тоглогчдыг харах</button>
            <button onclick="startGame()" style="width:100%; padding:15px; font-size:20px; background:#4caf50;">
                ТОГЛООМ ЭХЛҮҮЛЭХ
            </button>
        </div>

        <div id="game-screen" class="screen">
            <button onclick="goToMenu()" style="position:absolute; top:10px; left:10px;">← Буцах</button>
            <h2 id="question-display">Асуулт энд гарна...</h2>

            <canvas id="hangman-canvas" width="300" height="400"></canvas>

            <div class="word-container" id="word-display"></div>

            <div class="stats">
                <div class="stat-item">
                    <div>Түвшин</div>
                    <div id="level-display">1</div>
                </div>
                <div class="stat-item">
                    <div>Амь</div>
                    <div class="lives" id="lives-display">❤️❤️❤️❤️❤️❤️</div>
                </div>
                <div class="stat-item">
                    <div>Оноо</div>
                    <div id="score-display">0</div>
                </div>
                <div class="stat-item" id="timer-container" style="display:none;">
                    <div>Үлдсэн цаг</div>
                    <div id="timer-display">60</div>
                </div>
            </div>

            <div class="powerups">
                <button class="powerup-btn" id="reveal-btn" onclick="usePowerup('reveal')">Нэг үсэг нээх (-200)</button>
                <button class="powerup-btn" id="life-btn" onclick="usePowerup('life')">Нэмэлт амь (+1) (-500)</button>
                <button class="powerup-btn" id="skip-btn" onclick="usePowerup('skip')">Үгийг алгасах (-300)</button>
            </div>

            <div class="keyboard" id="keyboard"></div>
        </div>

        <div id="leaderboard-screen" class="screen">
            <h1>ШИЛДЭГ ТОГЛОГЧДЫН ЖАГСААЛТ</h1>
            <table id="leaderboard-table">
                <thead>
                    <tr>
                        <th>Байр</th>
                        <th>Нэр</th>
                        <th>Оноо</th>
                        <th>Түвшин</th>
                        <th>Горим</th>
                        <th>Огноо</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <button onclick="goToMenu()" style="width:100%; margin-top:20px;">Нүүр хуудас руу буцах</button>
        </div>
    </div>

    <script>
        // Same data and variables as before (Mongolian letters, categories, gameState, etc.)
        const MONGOLIAN_LETTERS = "АБВГДЕЁЖЗИЙКЛМНОӨПРСТУҮФХЦЧШЩЪЫЬЭЮЯ".split('');

        const questionCategories = {
            animals: [
                { question: "Дэлхийн хамгийн том хөхтөн амьтан?", answer: "ХӨХХАЛ" },
                { question: "Африкт амьдардаг өндөр амьтан?", answer: "ТАХЬ" },
                { question: "Монголд амьдардаг араатан?", answer: "БААВГАЙ" },
                { question: "Далайд амьдардаг том загас?", answer: "ХАЛУУ" },
                { question: "Шувууны овгийн хамгийн том нь?", answer: "ТЭМЭЭ" }
            ],
            vehicles: [
                { question: "Агаарт нисдэг тээврийн хэрэгсэл?", answer: "НИСЭХОНГОЦ" },
                { question: "Усанд явдаг том хөлөг?", answer: "УСАНХӨЛӨГ" },
                { question: "Монголд түгээмэл машин?", answer: "ПРИУС" }
            ],
            geography: [
                { question: "Монгол улсын нийслэл хот?", answer: "УЛААНБААТАР" },
                { question: "Дэлхийн хамгийн өндөр уул?", answer: "ЭВЕРЕСТ" },
                { question: "Дэлхийн хамгийн том тив?", answer: "АЗИ" },
                { question: "Монголын хамгийн том нуур?", answer: "ХӨВСГӨЛ" }
            ],
            general: [
                { question: "Монголын үндэсний баяр?", answer: "НААДАМ" },
                { question: "Монголын үндэсний хувцас?", answer: "ДЭЭЛ" },
                { question: "Монголын үндэсний хөгжим?", answer: "МОРЬНХУУР" }
            ]
        };

        let gameState = {
            username: "",
            mode: "infinite",
            category: "animals",
            currentLevel: 1,
            lives: 6,
            score: 0,
            currentWord: "",
            currentQuestion: "",
            revealedLetters: [],
            triedPositions: {},
            usedLetters: new Set(),
            timer: 60,
            timerInterval: null,
            selectedPosition: null
        };

        const screens = {
            menu: document.getElementById('main-menu'),
            game: document.getElementById('game-screen'),
            leaderboard: document.getElementById('leaderboard-screen')
        };

        document.addEventListener('DOMContentLoaded', () => {
            createKeyboard();
            loadLeaderboard();
            drawHangman(); // Draw initial gallows
        });

        // ... (createKeyboard, startGame, nextLevel, renderWord, selectPosition, guessLetter, etc. remain exactly the same as in previous version)

        // === ONLY THIS FUNCTION IS UPDATED ===
        function drawHangman() {
            const canvas = document.getElementById('hangman-canvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.strokeStyle = '#333';
            ctx.fillStyle = '#333';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';

            const mistakes = 6 - gameState.lives;

            // === ALWAYS DRAW THE GALLOWS (hanger) ===
            // Base
            ctx.beginPath();
            ctx.moveTo(30, 370);
            ctx.lineTo(270, 370);
            ctx.lineTo(270, 350);
            ctx.lineTo(150, 350);
            ctx.lineTo(150, 60);
            ctx.lineTo(220, 60);
            ctx.lineTo(220, 100);
            ctx.stroke();

            // Rope
            ctx.beginPath();
            ctx.moveTo(220, 100);
            ctx.lineTo(220, 140);
            ctx.stroke();

            // === BODY PARTS (progressive) ===
            if (mistakes >= 1) {
                // Head
                ctx.beginPath();
                ctx.arc(220, 170, 30, 0, Math.PI * 2);
                ctx.stroke();

                // Eyes when almost dead
                if (mistakes >= 5) {
                    ctx.beginPath();
                    ctx.moveTo(205, 160);
                    ctx.lineTo(215, 170);
                    ctx.moveTo(225, 160);
                    ctx.lineTo(235, 170);
                    ctx.moveTo(205, 180);
                    ctx.lineTo(215, 170);
                    ctx.moveTo(225, 180);
                    ctx.lineTo(235, 170);
                    ctx.stroke();
                }
            }

            if (mistakes >= 2) {
                // Body
                ctx.beginPath();
                ctx.moveTo(220, 200);
                ctx.lineTo(220, 280);
                ctx.stroke();
            }

            if (mistakes >= 3) {
                // Left Arm
                ctx.beginPath();
                ctx.moveTo(220, 220);
                ctx.lineTo(180, 260);
                ctx.stroke();
            }

            if (mistakes >= 4) {
                // Right Arm
                ctx.beginPath();
                ctx.moveTo(220, 220);
                ctx.lineTo(260, 260);
                ctx.stroke();
            }

            if (mistakes >= 5) {
                // Left Leg
                ctx.beginPath();
                ctx.moveTo(220, 280);
                ctx.lineTo(180, 330);
                ctx.stroke();
            }

            if (mistakes >= 6) {
                // Right Leg + drop effect
                ctx.beginPath();
                ctx.moveTo(220, 280);
                ctx.lineTo(260, 330);
                ctx.stroke();

                // Slight drop animation (elongated neck)
                ctx.setLineDash([10, 10]);
                ctx.beginPath();
                ctx.moveTo(220, 140);
                ctx.lineTo(220, 160);
                ctx.stroke();
                ctx.setLineDash([]);
            }
        }
        // ======================================

        // The rest of the functions (usePowerup, resetKeyboard, leaderboard, navigation, etc.) remain unchanged

        function createKeyboard() {
            const keyboard = document.getElementById('keyboard');
            keyboard.innerHTML = '';
            MONGOLIAN_LETTERS.forEach(letter => {
                const key = document.createElement('div');
                key.className = 'key';
                key.textContent = letter;
                key.onclick = () => guessLetter(letter);
                keyboard.appendChild(key);
            });
        }

        function startGame() {
            const username = document.getElementById('username').value.trim();
            if (!username) {
                alert("Та нэрээ оруулна уу!");
                return;
            }

            gameState.username = username;
            gameState.mode = document.getElementById('game-mode').value;
            gameState.category = document.getElementById('category').value;
            gameState.currentLevel = 1;
            gameState.lives = 6;
            gameState.score = 0;
            gameState.usedLetters.clear();
            gameState.triedPositions = {};
            gameState.selectedPosition = null;

            if (gameState.mode === 'timed') {
                document.getElementById('timer-container').style.display = 'block';
            } else {
                document.getElementById('timer-container').style.display = 'none';
            }

            switchScreen('game');
            nextLevel();
        }

        function nextLevel() {
            const words = questionCategories[gameState.category];
            const selected = words[Math.floor(Math.random() * words.length)];
            gameState.currentQuestion = selected.question;
            gameState.currentWord = selected.answer.toUpperCase();
            gameState.revealedLetters = new Array(gameState.currentWord.length).fill('_');
            gameState.selectedPosition = null;

            document.getElementById('question-display').textContent = gameState.currentQuestion;
            document.getElementById('level-display').textContent = gameState.currentLevel;
            document.getElementById('score-display').textContent = gameState.score;
            document.getElementById('lives-display').innerHTML = '❤️'.repeat(gameState.lives);

            renderWord();
            resetKeyboard();
            drawHangman();

            if (gameState.mode === 'timed') {
                gameState.timer = 60;
                document.getElementById('timer-display').textContent = gameState.timer;
                if (gameState.timerInterval) clearInterval(gameState.timerInterval);
                gameState.timerInterval = setInterval(updateTimer, 1000);
            }
        }

        function renderWord() {
            const container = document.getElementById('word-display');
            container.innerHTML = '';
            for (let i = 0; i < gameState.currentWord.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'letter-slot';
                if (gameState.selectedPosition === i) {
                    slot.style.border = '3px solid #ffd700';
                }
                slot.onclick = () => selectPosition(i);

                const num = document.createElement('div');
                num.className = 'position-number';
                num.textContent = i + 1;
                slot.appendChild(num);

                const letterDiv = document.createElement('div');
                letterDiv.textContent = gameState.revealedLetters[i] === '_' ? '' : gameState.revealedLetters[i];
                slot.appendChild(letterDiv);

                if (gameState.revealedLetters[i] !== '_' && gameState.revealedLetters[i] === gameState.currentWord[i]) {
                    slot.classList.add('revealed');
                }

                container.appendChild(slot);
            }
        }

        function selectPosition(pos) {
            gameState.selectedPosition = pos;
            renderWord();
        }

        function guessLetter(letter) {
            if (gameState.selectedPosition === null) {
                alert("Эхлээд үсгийн байрыг сонгоно уу!");
                return;
            }

            const pos = gameState.selectedPosition;
            const correctLetter = gameState.currentWord[pos];

            document.querySelectorAll('.key').forEach(k => {
                if (k.textContent === letter) k.classList.add('used');
            });

            if (letter === correctLetter) {
                gameState.revealedLetters[pos] = letter;
                gameState.score += 100 * gameState.currentLevel;
                renderWord();
                updateScore();

                if (!gameState.revealedLetters.includes('_')) {
                    levelComplete();
                }
            } else {
                if (!gameState.triedPositions[pos]) gameState.triedPositions[pos] = [];
                if (!gameState.triedPositions[pos].includes(letter)) {
                    gameState.triedPositions[pos].push(letter);
                    gameState.lives--;
                    updateLives();
                    drawHangman();

                    if (gameState.lives <= 0) {
                        gameOver();
                    }
                }
            }

            gameState.selectedPosition = null;
            renderWord();
        }

        function updateLives() {
            document.getElementById('lives-display').innerHTML = '❤️'.repeat(gameState.lives) + '♡'.repeat(6 - gameState.lives);
        }

        function updateScore() {
            document.getElementById('score-display').textContent = gameState.score;
        }

        function levelComplete() {
            gameState.score += 500 + (gameState.lives * 100);
            updateScore();
            gameState.currentLevel++;

            if (gameState.mode === 'standard' && gameState.currentLevel > 3) {
                gameWin();
            } else {
                setTimeout(() => {
                    alert(`Амжилттай дууслаа! Түвшин ${gameState.currentLevel} руу шилжлээ.`);
                    nextLevel();
                }, 500);
            }
        }

        function gameOver() {
            clearInterval(gameState.timerInterval);
            alert(`Тоглоом дууслаа! Таны оноо: ${gameState.score}`);
            saveToLeaderboard();
            goToMenu();
        }

        function gameWin() {
            alert(`Та яллаа! Бүх түвшинг дуусгалаа. Оноо: ${gameState.score}`);
            saveToLeaderboard();
            goToMenu();
        }

        function updateTimer() {
            gameState.timer--;
            document.getElementById('timer-display').textContent = gameState.timer;
            if (gameState.timer <= 0) {
                gameState.lives--;
                updateLives();
                drawHangman();
                if (gameState.lives <= 0) {
                    gameOver();
                } else {
                    nextLevel();
                }
            }
        }

        function usePowerup(type) {
            if (type === 'reveal' && gameState.score >= 200) {
                gameState.score -= 200;
                const hidden = gameState.revealedLetters.map((l, i) => l === '_' ? i : -1).filter(i => i >= 0);
                if (hidden.length > 0) {
                    const pos = hidden[Math.floor(Math.random() * hidden.length)];
                    gameState.revealedLetters[pos] = gameState.currentWord[pos];
                    renderWord();
                    updateScore();
                }
            } else if (type === 'life' && gameState.score >= 500 && gameState.lives < 6) {
                gameState.score -= 500;
                gameState.lives++;
                updateLives();
                drawHangman();
                updateScore();
            } else if (type === 'skip' && gameState.score >= 300) {
                gameState.score -= 300;
                updateScore();
                nextLevel();
            } else {
                alert("Оноо хүрэлцэхгүй эсвэл боломжгүй!");
            }
        }

        function resetKeyboard() {
            document.querySelectorAll('.key').forEach(k => {
                k.classList.remove('used');
            });
        }

        function saveToLeaderboard() {
            let leaderboard = JSON.parse(localStorage.getItem('hangmanLeaderboard') || '[]');
            leaderboard.push({
                username: gameState.username,
                score: gameState.score,
                levelReached: gameState.currentLevel - 1,
                mode: gameState.mode,
                date: new Date().toISOString().split('T')[0]
            });

            leaderboard.sort((a, b) => b.score - a.score);
            leaderboard = leaderboard.slice(0, 10);
            localStorage.setItem('hangmanLeaderboard', JSON.stringify(leaderboard));
        }

        function loadLeaderboard() {
            const tbody = document.querySelector('#leaderboard-table tbody');
            let leaderboard = JSON.parse(localStorage.getItem('hangmanLeaderboard') || '[]');
            tbody.innerHTML = '';

            leaderboard.forEach((entry, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${entry.username}</td>
                    <td>${entry.score}</td>
                    <td>${entry.levelReached}</td>
                    <td>${entry.mode === 'infinite' ? 'Хязгааргүй' : entry.mode === 'timed' ? 'Цагтай' : 'Стандарт'}</td>
                    <td>${entry.date}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function showLeaderboard() {
            loadLeaderboard();
            switchScreen('leaderboard');
        }

        function switchScreen(screenName) {
            Object.values(screens).forEach(s => s.classList.remove('active'));
            screens[screenName].classList.add('active');
        }

        function goToMenu() {
            switchScreen('menu');
        }
    </script>
</body>
</html>